# 第06章_索引的数据结构

## 1. 为什么使用索引

![image-20220905154946702](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905154946702.png)

假如给数据使用 二叉树 这样的数据结构进行存储，如下图所示![image-20220905155207335](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905155207335.png)

## 2. 索引及其优缺点

### 2.1 索引概述

MySQL官方对索引的定义为：**索引（Index）是帮助MySQL高效获取数据的数据结构。**

**索引的本质**：索引是数据结构。你可以简单理解为“排好序的快速查找数据结构”，满足特定查找算法。 这些数据结构以某种方式指向数据， 这样就可以在这些数据结构的基础上实现 高级查找算法 。

### 2.2 优点

（1）类似大学图书馆建书目索引，提高数据检索的效率，降低 **数据库的IO成本** ，这也是创建索引最主 要的原因。 （2）通过创建唯一索引，可以保证数据库表中每一行 **数据的唯一性** 。 （3）在实现数据的 参考完整性方面，可以 **加速表和表之间的连接** 。换句话说，对于有依赖关系的子表和父表联合查询时， 可以提高查询速度。 （4）在使用分组和排序子句进行数据查询时，可以显著 **减少查询中分组和排序的时 间** ，降低了CPU的消耗。

### 2.3 缺点

增加索引也有许多不利的方面，主要表现在如下几个方面： （1）创建索引和维护索引要 **耗费时间** ，并 且随着数据量的增加，所耗费的时间也会增加。 （2）索引需要占 **磁盘空间** ，除了数据表占数据空间之 外，每一个索引还要占一定的物理空间**， 存储在磁盘上** ，如果有大量的索引，索引文件就可能比数据文 件更快达到最大文件尺寸。 （3）虽然索引大大提高了查询速度，同时却会 **降低更新表的速度** 。当对表 中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。

 因此，选择使用索引时，需要综合考虑索引的优点和缺点。

## 3. InnoDB中索引的推演

### 3.1 索引之前的查找

先来看一个精确匹配的例子：

```javascript
SELECT [列名列表] FROM 表名 WHERE 列名 = xxx;
```

### 1. 在一个页中的查找

###  2. 在很多页中查找

在没有索引的情况下，不论是根据主键列或者其他列的值进行查找，由于我们并不能快速的定位到记录 所在的页，所以只能 **从第一个页** 沿着 **双向链表** 一直往下找，在每一个页中根据我们上面的查找方式去查 找指定的记录。因为要遍历所有的数据页，所以这种方式显然是 **超级耗时** 的。如果一个表有一亿条记录 呢？此时 **索引** 应运而生。

![image-20220905161107325](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905161107325.png)

通过索引创建表

```mysql
 CREATE TABLE index_demo(
 c1 INT,
 c2 INT,
 c3 CHAR(1),
 PRIMARY KEY(c1)
 ) ROW_FORMAT = Compact;
```

这个新建的 index_demo 表中有2个INT类型的列，1个CHAR(1)类型的列，而且我们规定了c1列为主键，

这里的表,通过`Compact`行格式来实际存储记录的,这里外面简化了index_demo表的行格式示意图:

![image-20220905161838840](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905161838840.png)

我们只在示意图里展示记录的这几个部分：

- record_type ：记录头信息的一项属性，表示记录的类型， 0 表示普通记录、 2 表示最小记 录、 3 表示最大记录、 1 暂时还没用过，下面讲。

- next_record ：记录头信息的一项属性，表示下一条地址相对于本条记录的地址偏移量，我们用 箭头来表明下一条记录是谁。
- 各个列的值 ：这里只记录在 index_demo 表中的三个列，分别是 c1 、 c2 和 c3 。
- 其他信息 ：除了上述3种信息以外的所有信息，包括其他隐藏列的值以及记录的额外信息。

将记录格式示意图的其他信息项暂时去掉并把它竖起来的效果就是这样：

![image-20220905162515534](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905162515534.png)

把一些记录放到页里的示意图就是

![image-20220905162617217](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220905162617217.png)

### 1. 一个简单的索引设计方案

我们在根据某个搜索条件查找一些记录时为什么要遍历所有的数据页呢？因为各个页中的记录并没有规 律，我们并不知道我们的搜索条件匹配哪些页中的记录，所以不得不依次遍历所有的数据页。所以如果 我们 **想快速的定位到需要查找的记录在哪些数据页** 中该咋办？我们可以为快速定位记录所在的数据页而 **建 立一个目录** ，建这个目录必须完成下边这些事：

- **下一个数据页中用户记录的主键值必须大于上一个页中用户记录的主键值。**
- **给所有的页建立一个目录项。**