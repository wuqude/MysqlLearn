# 第13章_事务基础知识

## 1. 数据库事务概述

### 1.1 存储引擎支持情况

SHOW ENGINES 命令来查看当前 MySQL 支持的存储引擎都有哪些，以及这些存储引擎是否支持事务。

![image-20220906134622049](C:\Users\Yilin.Yang\AppData\Roaming\Typora\typora-user-images\image-20220906134622049.png)

能看出在 MySQL 中，只有InnoDB 是支持事务的。

### 1.2 基本概念

**事务**：一组逻辑操作单元，使数据从一种状态变换到另一种状态。

**事务处理的原则**：保证所有事务都作为 **一个工作单元** 来执行，即使出现了故障，都不能改变这种执行方 式。当在一个事务中执行多个操作时，要么所有的事务都被提交( **commit** )，那么这些修改就 **永久** 地保 存下来；要么数据库管理系统将 放弃 所作的所有 修改 ，整个事务回滚( **rollback** )到最初状态。

### 1.3 事务的ACID特性

- 原子性（atomicity）：

原子性是指事务是一个不可分割的工作单位，要么全部提交，要么全部失败回滚。

- 一致性（consistency）：

事务执行后，数据库状态与其它业务规则保持一致。其他特性都是为了给一致性服务的. 例如买东西,张三买李四的东西, 买卖前和买卖后张三和李四的所有钱数之和是保持不变的.

- **隔离性**

 事务和事务之间是隔离开的. 一个事务看不到另一个事务正在操作的数据(正在进行中的状态)(两个人在两个房间考试)

- **持久性:**

一旦事务提交成功，事务中所有的数据操作都必须被持久化到数据库中，即使提交事务后，数据库马上崩溃，在数据库重启时，也必须能保证通过某种机制将数据恢复到提交后的状态。 举例: 一般的数据操作只是在事务中记录需要进行这样的操作, 即使看到了表中的数据发生了改变, 实际上表中的数据也没有发生改变只是在事务中记录需要进行这样的操作, 真正提交了事务才去表中改变表中的数据.
**开启事务—A给B转账500元**

A: 1000 - 500 = 500 (成功了) 在日志中记录,事务成功,A账户金额更新为500

B: 1000 + 500 = 1500 (成功了) 在日志中记录,事务成功,B账户金额更新为1500

结束事务—回滚/提交

### 三、事务并发读问题

**1.脏读（dirty read）:** 一个事务读到了另一个事务未提交的事务.

注意:mysql默认的是**不允许出现脏读和不可重复读**，所以在下面演示之前需要设置mysql允许出现脏读、不可重复读等。

**2.不可重复读（unrepeatable read）：** 对同一记录的两次读取结果不一致，因为在两次查询期间，有另一事务对该记录做了修改（是针对修改操作）